<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>試合結果リアルタイム表示</title>
    <link href="/common/realtime2.css" rel="stylesheet" type="text/css" />
</head>

<body>
    <div class="container">
        <div class="content" id="score"></div>
    </div>
</body>
<script type="text/javascript" src="/common/jquery-3.0.0.min.js"></script>
<script type="text/javascript" src="config.js"></script>
<script type="text/javascript">

    let conn = null;

    function open() {
        //conn = new WebSocket('wss://www.kendo-web.net/wss2/');
        conn = new WebSocket('ws://' + base_ip + ':3000/');

        conn.onopen = function (e) {
            conn.send('{"mode":1,"navi":' + mavi_id + ',"places":[2]}');
        };

        conn.onerror = function (e) {
            alert("エラーが発生しました");
        };

        conn.onmessage = function (e) {
            console.log('message');
            var data = JSON.parse(e.data);
            if (data["navi"] != mavi_id) { return; }
            if (data["place"] != 2) { return; }
            $("#score").html(data["html"]);
        };

        conn.onclose = function () {
            alert("切断しました");
            setTimeout(open, 5000);
        };
    }

    open();
</script>

<script>
    (function (i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
            (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date(); a = s.createElement(o),
            m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
    })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');
    ga('create', 'UA-67305136-4', 'auto');
    ga('send', 'pageview');
</script>

</html>